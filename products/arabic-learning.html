<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Vocabulary Categories</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
<style>
body { margin:0; font-family:'Cairo',sans-serif; background:linear-gradient(135deg,#f8f9fb,#e8f0ff); display:flex; flex-direction:column; align-items:center; padding:15px; min-height:100vh; }
h1 { font-size:2.4rem; margin-bottom:4px; color:#222; text-align:center; font-weight:700; letter-spacing:0.5px; }
.container { display:flex; flex-direction:column; align-items:center; padding:20px; width:100%; max-width:900px; }
.card { display:flex; align-items:center; justify-content:space-between; width:100%; padding:16px 24px; margin:8px 0; border-radius:12px; box-shadow:0 4px 15px rgba(0,0,0,0.05); text-decoration:none; color:#222; background:transparent; transition: all 0.25s ease; border:1px solid #e5e7eb; backdrop-filter:blur(4px);}
.card:hover { transform:translateY(-5px); box-shadow:0 8px 25px rgba(0,0,0,0.1); background:rgba(255,255,255,0.5); }
.emoji { font-size:2.2rem; margin-right:18px; width:60px; height:60px; display:flex; align-items:center; justify-content:center; background:#fff; border-radius:12px; box-shadow:0 3px 8px rgba(0,0,0,0.07);}
.text { flex-grow:1; display:flex; flex-direction:column; }
.text span { font-size:1.1rem; font-weight:600; }
.count { font-size:0.9rem; color:#666; margin-top:3px;}
@media (max-width:600px){ .card{ flex-direction:column; align-items:center; text-align:center; } .emoji{ margin-right:0; margin-bottom:10px;} }

.card.locked { position:relative; opacity:0.85; cursor:not-allowed; }
.card.locked::after { content:"ðŸ”’"; position:absolute; right:70px; top:50%; transform:translateY(-50%); font-size:3rem; }

body.modal-open *:not(.modal):not(.modal *) { filter:blur(6px); pointer-events:none; }

.modal { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.45); display:none; align-items:center; justify-content:center; z-index:999; }
.modal-content { background:#fff; width:90%; max-width:420px; border-radius:16px; padding:25px; text-align:center; box-shadow:0 8px 25px rgba(0,0,0,0.15); }

.price { font-size:2.4rem; font-weight:700; color:#222; }
.per { font-size:1rem; color:#666; margin-top:-5px; }
.pay-btn { width:100%; padding:14px; background:#007bff; color:#fff; border:none; border-radius:10px; margin:18px 0; font-size:1.2rem; cursor:pointer; }
.login-btn { width:100%; padding:12px; background:#eee; border:1px solid #ccc; border-radius:10px; font-size:1.1rem; margin-top:10px; cursor:pointer; }

.already { font-size:0.8rem; color:#666; margin-top:6px; }
.benefits { text-align:left; margin:15px 0; color:#444; line-height:1.5; }

#loginStatus { position:fixed; bottom:10px; right:10px; background:#fff; padding:10px 15px; border-radius:8px; box-shadow:0 2px 8px rgba(0,0,0,0.15); font-size:0.9rem; display:none; }

#loginAlert { font-size:1rem; margin-bottom:10px; font-weight:600; }
#loginAlert.paid { color:green; }
#loginAlert.not-paid { color:red; }
</style>
</head>
<body>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDPu5kkhRugeFb9XaJ-vsSH3wbzpK5TS9U",
  authDomain: "noun-a42d5.firebaseapp.com",
  projectId: "noun-a42d5",
  storageBucket: "noun-a42d5.firebasestorage.app",
  messagingSenderId: "1082712137091",
  appId: "1:1082712137091:web:25a3efbe474646c79eeab6",
  measurementId: "G-13NZGDFDDV"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const provider = new GoogleAuthProvider();

let isPaidAccount = false;
const loginAlert = document.getElementById("loginAlert");
const payModal = document.getElementById("payModal");

// 1. LOGIN FUNCTION
document.querySelector(".login-btn").addEventListener("click", async () => {
  try {
    await signInWithPopup(auth, provider);
  } catch (err) {
    console.error("Login error:", err);
    alert("Login failed: " + err.message);
  }
});

// 2. AUTH STATE & UNLOCK LOGIC
onAuthStateChanged(auth, async (user) => {
  if (!user) {
    console.log("No user logged in.");
    return;
  }

  const email = user.email;
  document.getElementById("loginStatus").style.display = "block";
  document.getElementById("loginStatus").innerHTML = `Logged in as <b>${email}</b>`;

  // Firestore check
  try {
    const usersRef = collection(db, "users");
    const q = query(usersRef, where("email", "==", email));
    const snapshot = await getDocs(q);

    if (!snapshot.empty) {
      const data = snapshot.docs[0].data();
      console.log("User Data Found:", data);

      if (data.isPaid === true || data.fullAccess === true) {
        isPaidAccount = true;
        unlockContent();
      } else {
        loginAlert.textContent = "âŒ This account is not paid";
        loginAlert.className = "not-paid";
      }
    } else {
      console.log("No matching user document found for:", email);
      loginAlert.textContent = "âŒ Email not found in database";
      loginAlert.className = "not-paid";
    }
  } catch (error) {
    console.error("Firestore Error:", error);
  }
});

function unlockContent() {
  loginAlert.textContent = "âœ… Access Granted!";
  loginAlert.className = "paid";
  
  // Hide modal
  payModal.style.display = "none";
  document.body.classList.remove("modal-open");

  // Unlock cards
  document.querySelectorAll(".card[data-link]").forEach(card => {
    card.classList.remove("locked");
    card.href = card.getAttribute("data-link"); // Set the real link
    card.style.cursor = "pointer";
  });
}

// 3. HANDLE CLICKS ON LOCKED CARDS
document.querySelectorAll(".card").forEach(card => {
  card.addEventListener("click", (e) => {
    // If it still has the locked class, prevent navigation and show modal
    if (card.classList.contains("locked")) {
      e.preventDefault();
      payModal.style.display = 'flex';
      document.body.classList.add('modal-open');
    }
  });
});

// Close modal on outside click
payModal.addEventListener("click", (e) => {
  if (e.target === payModal) {
    payModal.style.display = "none";
    document.body.classList.remove("modal-open");
  }
});
</script>
</body>
</html>

